import prepareCrawlIds from '../../utils/prepareCrawlIds';
import getStatistics from './getStatistics';

const portfolios = {
  '0': [
    {
      _id: '63f2c653e2e73d1e3e676fdc',
      chain: 'matic',
      crawl_id: 22001,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0x274e5361ee2c3c881da3ffe1e3b759bfecb632bc',
      amount: 711975.383,
      crawl_time: 1676852456,
      price: 1.489,
      source: 'debank',
      updated_at: '2023-02-20T01:00:19.739Z',
      usd_value: 1060131.345287,
    },
    {
      _id: '63f2c653e2e73d1e3e677559',
      chain: 'matic',
      crawl_id: 22001,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0x9fdee27d8a418685f6855066923e57b5de4b5672',
      amount: 582571.046,
      crawl_time: 1676852277,
      price: 1.49,
      source: 'debank',
      updated_at: '2023-02-20T01:00:19.995Z',
      usd_value: 868030.8585399999,
    },
    {
      _id: '63f2c715e2e73d1e3e6ac0ec',
      chain: 'matic',
      crawl_id: 22001,
      pool_id: '0x369582d2010b6ed950b571f4101e3bb9b554876f',
      ref_id: 'matic-0',
      symbol: 'MATIC',
      wallet_address: '0xcb5cea9e0000e02552f520f401d1f6793814c1e2',
      amount: 49588.662,
      crawl_time: 1676852038,
      dao_id: null,
      platform_token_id: '0x831753dd7087cac61ab5644b308642cc1c33dc13',
      pool_adapter_id: 'uniswap2_liquidity_proxy',
      price: 1.49,
      source: 'debank',
      updated_at: '2023-02-20T01:04:01.775Z',
      usd_value: 73887.10638,
    },
    {
      _id: '63f2c74be2e73d1e3e6d155d',
      chain: 'eth',
      crawl_id: 22001,
      pool_id: '0xc7757805b983ee1b6272c1840c18e66837de858e',
      ref_id: '0x7d1afa7b718fb893db30a3abc0cfc608aacfebb0-0',
      symbol: 'MATIC',
      wallet_address: '0xcb5cea9e0000e02552f520f401d1f6793814c1e2',
      amount: 661854.731,
      crawl_time: 1676852038,
      dao_id: 'polygon',
      platform_token_id: '',
      pool_adapter_id: 'polygon_staked',
      price: 1.49,
      source: 'debank',
      updated_at: '2023-02-20T01:04:13.934Z',
      usd_value: 986163.54919,
    },
    {
      _id: '63f2c653e2e73d1e3e6779cc',
      chain: 'eth',
      crawl_id: 22001,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0xd6a062cae6123c158768a5c444ca0896cc60d6b1',
      amount: 607511.647,
      crawl_time: 1676852189,
      price: 1.488,
      source: 'debank',
      updated_at: '2023-02-20T01:00:19.942Z',
      usd_value: 903977.330736,
    },
  ],
  '3': [
    {
      _id: '63f29c0be2e73d1e3e594cad',
      chain: 'matic',
      crawl_id: 21908,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0x274e5361ee2c3c881da3ffe1e3b759bfecb632bc',
      amount: 712012.249,
      crawl_time: 1676841652,
      price: 1.495,
      source: 'debank',
      updated_at: '2023-02-19T22:00:17.443Z',
      usd_value: 1064458.312255,
    },
    {
      _id: '63f29c0ce2e73d1e3e5954e3',
      chain: 'matic',
      crawl_id: 21908,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0x9fdee27d8a418685f6855066923e57b5de4b5672',
      amount: 582571.046,
      crawl_time: 1676841473,
      price: 1.494,
      source: 'debank',
      updated_at: '2023-02-19T22:00:17.708Z',
      usd_value: 870361.1427239999,
    },
    {
      _id: '63f29c47e2e73d1e3e5afb07',
      chain: 'matic',
      crawl_id: 21908,
      pool_id: '0x369582d2010b6ed950b571f4101e3bb9b554876f',
      ref_id: 'matic-0',
      symbol: 'MATIC',
      wallet_address: '0xcb5cea9e0000e02552f520f401d1f6793814c1e2',
      amount: 49588.662,
      crawl_time: 1676841235,
      dao_id: null,
      platform_token_id: '0x831753dd7087cac61ab5644b308642cc1c33dc13',
      pool_adapter_id: 'uniswap2_liquidity_proxy',
      price: 1.496,
      source: 'debank',
      updated_at: '2023-02-19T22:00:53.862Z',
      usd_value: 74184.638352,
    },
    {
      _id: '63f29c5de2e73d1e3e5bec56',
      chain: 'eth',
      crawl_id: 21908,
      pool_id: '0xc7757805b983ee1b6272c1840c18e66837de858e',
      ref_id: '0x7d1afa7b718fb893db30a3abc0cfc608aacfebb0-0',
      symbol: 'MATIC',
      wallet_address: '0xcb5cea9e0000e02552f520f401d1f6793814c1e2',
      amount: 661854.731,
      crawl_time: 1676841235,
      dao_id: 'polygon',
      platform_token_id: '',
      pool_adapter_id: 'polygon_staked',
      price: 1.496,
      source: 'debank',
      updated_at: '2023-02-19T22:00:34.044Z',
      usd_value: 990134.677576,
    },
    {
      _id: '63f29c0be2e73d1e3e5952e2',
      chain: 'eth',
      crawl_id: 21908,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0xd6a062cae6123c158768a5c444ca0896cc60d6b1',
      amount: 607511.647,
      crawl_time: 1676841384,
      price: 1.493,
      source: 'debank',
      updated_at: '2023-02-19T22:00:17.653Z',
      usd_value: 907014.8889710001,
    },
  ],
  '6': [
    {
      _id: '63f271d2e2e73d1e3e4b297c',
      chain: 'matic',
      crawl_id: 21907,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0x274e5361ee2c3c881da3ffe1e3b759bfecb632bc',
      amount: 711822.204,
      crawl_time: 1676830857,
      price: 1.508,
      source: 'debank',
      updated_at: '2023-02-19T19:00:19.786Z',
      usd_value: 1073427.883632,
    },
    {
      _id: '63f271d6e2e73d1e3e4b4e01',
      chain: 'matic',
      crawl_id: 21907,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0x9fdee27d8a418685f6855066923e57b5de4b5672',
      amount: 582571.046,
      crawl_time: 1676830678,
      price: 1.508,
      source: 'debank',
      updated_at: '2023-02-19T19:00:20.278Z',
      usd_value: 878517.137368,
    },
    {
      _id: '63f271fde2e73d1e3e4cb020',
      chain: 'matic',
      crawl_id: 21907,
      pool_id: '0x369582d2010b6ed950b571f4101e3bb9b554876f',
      ref_id: 'matic-0',
      symbol: 'MATIC',
      wallet_address: '0xcb5cea9e0000e02552f520f401d1f6793814c1e2',
      amount: 49588.662,
      crawl_time: 1676830440,
      dao_id: null,
      platform_token_id: '0x831753dd7087cac61ab5644b308642cc1c33dc13',
      pool_adapter_id: 'uniswap2_liquidity_proxy',
      price: 1.498,
      source: 'debank',
      updated_at: '2023-02-19T19:00:51.340Z',
      usd_value: 74283.815676,
    },
    {
      _id: '63f27212e2e73d1e3e4d8db2',
      chain: 'eth',
      crawl_id: 21907,
      pool_id: '0xc7757805b983ee1b6272c1840c18e66837de858e',
      ref_id: '0x7d1afa7b718fb893db30a3abc0cfc608aacfebb0-0',
      symbol: 'MATIC',
      wallet_address: '0xcb5cea9e0000e02552f520f401d1f6793814c1e2',
      amount: 661812.941,
      crawl_time: 1676830440,
      dao_id: 'polygon',
      platform_token_id: '',
      pool_adapter_id: 'polygon_staked',
      price: 1.5,
      source: 'debank',
      updated_at: '2023-02-19T19:00:37.970Z',
      usd_value: 992719.4114999999,
    },
    {
      _id: '63f271d6e2e73d1e3e4b4e6f',
      chain: 'eth',
      crawl_id: 21907,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0xd6a062cae6123c158768a5c444ca0896cc60d6b1',
      amount: 607511.647,
      crawl_time: 1676830591,
      price: 1.508,
      source: 'debank',
      updated_at: '2023-02-19T19:00:20.074Z',
      usd_value: 916127.563676,
    },
  ],
  '12': [
    {
      _id: '63f21d77e2e73d1e3e2e3272',
      chain: 'matic',
      crawl_id: 21905,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0x274e5361ee2c3c881da3ffe1e3b759bfecb632bc',
      amount: 711874.281,
      crawl_time: 1676809255,
      price: 1.505,
      source: 'debank',
      updated_at: '2023-02-19T13:00:17.608Z',
      usd_value: 1071370.7929049998,
    },
    {
      _id: '63f21d7ae2e73d1e3e2e49dd',
      chain: 'matic',
      crawl_id: 21905,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0x9fdee27d8a418685f6855066923e57b5de4b5672',
      amount: 582571.046,
      crawl_time: 1676809075,
      price: 1.506,
      source: 'debank',
      updated_at: '2023-02-19T13:00:17.900Z',
      usd_value: 877351.995276,
    },
    {
      _id: '63f21dbae2e73d1e3e2fca54',
      chain: 'matic',
      crawl_id: 21905,
      pool_id: '0x369582d2010b6ed950b571f4101e3bb9b554876f',
      ref_id: 'matic-0',
      symbol: 'MATIC',
      wallet_address: '0xcb5cea9e0000e02552f520f401d1f6793814c1e2',
      amount: 48670.192,
      crawl_time: 1676808837,
      dao_id: null,
      platform_token_id: '0x831753dd7087cac61ab5644b308642cc1c33dc13',
      pool_adapter_id: 'uniswap2_liquidity_proxy',
      price: 1.51,
      source: 'debank',
      updated_at: '2023-02-19T13:00:58.386Z',
      usd_value: 73491.98992,
    },
    {
      _id: '63f21ea4e2e73d1e3e30dc3b',
      chain: 'eth',
      crawl_id: 21905,
      pool_id: '0xc7757805b983ee1b6272c1840c18e66837de858e',
      ref_id: '0x7d1afa7b718fb893db30a3abc0cfc608aacfebb0-0',
      symbol: 'MATIC',
      wallet_address: '0xcb5cea9e0000e02552f520f401d1f6793814c1e2',
      amount: 661812.941,
      crawl_time: 1676808837,
      dao_id: 'polygon',
      platform_token_id: '',
      pool_adapter_id: 'polygon_staked',
      price: 1.509,
      source: 'debank',
      updated_at: '2023-02-19T13:00:36.113Z',
      usd_value: 998675.7279689999,
    },
    {
      _id: '63f21d7be2e73d1e3e2e4fbd',
      chain: 'eth',
      crawl_id: 21905,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0xd6a062cae6123c158768a5c444ca0896cc60d6b1',
      amount: 607511.647,
      crawl_time: 1676808987,
      price: 1.506,
      source: 'debank',
      updated_at: '2023-02-19T13:00:17.832Z',
      usd_value: 914912.540382,
    },
  ],
  '24': [
    {
      _id: '63f1930fe2e73d1e3ec95fe1',
      chain: 'matic',
      crawl_id: 21901,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0x274e5361ee2c3c881da3ffe1e3b759bfecb632bc',
      amount: 712388.848,
      crawl_time: 1676766069,
      price: 1.484,
      source: 'debank',
      updated_at: '2023-02-19T03:09:57.900Z',
      usd_value: 1057185.050432,
    },
    {
      _id: '63f19286e2e73d1e3ec65d3a',
      chain: 'matic',
      crawl_id: 21901,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0x9fdee27d8a418685f6855066923e57b5de4b5672',
      amount: 582571.046,
      crawl_time: 1676765889,
      price: 1.482,
      source: 'debank',
      updated_at: '2023-02-19T03:07:49.431Z',
      usd_value: 863370.290172,
    },
    {
      _id: '63f192dfe2e73d1e3ec81256',
      chain: 'matic',
      crawl_id: 21901,
      pool_id: '0x369582d2010b6ed950b571f4101e3bb9b554876f',
      ref_id: 'matic-0',
      symbol: 'MATIC',
      wallet_address: '0xcb5cea9e0000e02552f520f401d1f6793814c1e2',
      amount: 48468.08,
      crawl_time: 1676765651,
      dao_id: null,
      platform_token_id: '0x831753dd7087cac61ab5644b308642cc1c33dc13',
      pool_adapter_id: 'uniswap2_liquidity_proxy',
      price: 1.483,
      source: 'debank',
      updated_at: '2023-02-19T03:08:44.094Z',
      usd_value: 71878.16264000001,
    },
    {
      _id: '63f192efe2e73d1e3ec8c25c',
      chain: 'eth',
      crawl_id: 21901,
      pool_id: '0xc7757805b983ee1b6272c1840c18e66837de858e',
      ref_id: '0x7d1afa7b718fb893db30a3abc0cfc608aacfebb0-0',
      symbol: 'MATIC',
      wallet_address: '0xcb5cea9e0000e02552f520f401d1f6793814c1e2',
      amount: 661773.514,
      crawl_time: 1676765651,
      dao_id: 'polygon',
      platform_token_id: '',
      pool_adapter_id: 'polygon_staked',
      price: 1.482,
      source: 'debank',
      updated_at: '2023-02-19T03:08:02.695Z',
      usd_value: 980748.347748,
    },
    {
      _id: '63f19286e2e73d1e3ec65a76',
      chain: 'eth',
      crawl_id: 21901,
      pool_id: null,
      ref_id: null,
      symbol: 'MATIC',
      wallet_address: '0xd6a062cae6123c158768a5c444ca0896cc60d6b1',
      amount: 607511.647,
      crawl_time: 1676765802,
      price: 1.482,
      source: 'debank',
      updated_at: '2023-02-19T03:07:49.371Z',
      usd_value: 900332.260854,
    },
  ],
  '168': [],
  '720': [],
  '1440': [],
};

describe('.getStatistics', () => {
  // Assert greeter result
  it('should return true', () => {
    const result = getStatistics({
      portfolios,
      crawl_ids: prepareCrawlIds({ crawl_id: 2023022001 }),
      filter: {},
    });

    expect(result).toEqual([
      {
        period: 0,
        amount: 2613501.469,
        usd_value: 3892190.19,
        from_time: 1676848200,
        to_time: 1676854200,
        price: 1.489
      },
      {
        period: 3,
        amount: 2613538.335,
        usd_value: 3906153.66,
        from_time: 1676837400,
        to_time: 1676843400,
        price: 1.495,
        percentage_change: -0.001,
        usd_percentage_change: -0.357
      },
      {
        period: 6,
        amount: 2613306.5,
        usd_value: 3935075.812,
        from_time: 1676826600,
        to_time: 1676832600,
        price: 1.504,
        percentage_change: 0.007,
        usd_percentage_change: -1.09
      },
      {
        period: 12,
        amount: 2612440.107,
        usd_value: 3935803.046,
        from_time: 1676805000,
        to_time: 1676811000,
        price: 1.507,
        percentage_change: 0.041,
        usd_percentage_change: -1.108
      },
      {
        period: 24,
        amount: 2612713.135,
        usd_value: 3873514.112,
        from_time: 1676761800,
        to_time: 1676767800,
        price: 1.483,
        percentage_change: 0.03,
        usd_percentage_change: 0.482
      }
    ]);
  });
});
